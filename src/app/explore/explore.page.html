<ion-header class="ion-no-border" *ngIf="!isFloorFullscreen">
  <app-fastpass-header
    class="screen-header"
    [selectedUserId]="selectedUserId"
    (userSelected)="onUserSelected($event)">
  </app-fastpass-header>
</ion-header>

<ion-content [fullscreen]="isFloorFullscreen" [scrollY]="false">
  <div class="screen-wrapper" [class.fullscreen-mode]="isFloorFullscreen">
    <div class="content-container" [class.has-toolbar]="viewMode !== 'map' && !isFloorFullscreen">
      <ng-container [ngSwitch]="viewMode">
        <div *ngSwitchCase="'map'" class="view-pane view-pane--map">
          <app-map-view></app-map-view>
        </div>

        <ion-card *ngSwitchCase="'building'" class="view-card">
          <ion-card-content>
            <div class="floating-card-header">
              <ion-button fill="clear" class="back-button" (click)="resetToBuildingOverview()">
                <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
              </ion-button>
              <div class="title-block">
                <p class="eyebrow">แผนผังอาคาร</p>
                <h2>{{ buildingData.buildingName }}</h2>
              </div>
            </div>
            <app-building-view
              [floors]="buildingData.floors"
              [activeFloor]="lastActiveFloor"
              (floorSelected)="onFloorSelected($event)">
            </app-building-view>

            <div class="card-overlay">
              <h2>{{ buildingData.buildingName }}</h2>
              <p>แตะที่ชั้นเพื่อเข้าชม</p>
            </div>
          </ion-card-content>
        </ion-card>

        <div *ngSwitchCase="'floor'" class="view-pane view-pane--floor">
          <app-floor-plan
            *ngIf="!isFloorFullscreen"
            [floorData]="selectedFloorData"
            [floors]="buildingData.floors"
            [activeFloorValue]="selectedFloorValue"
            [showBackButton]="true"
            [headerTitle]="selectedFloorData?.floorName"
            [fullscreenContext]="false"
            (backRequested)="resetToBuildingOverview()"
            (floorChange)="onFloorSelected($event)"
            (fullscreenChange)="onFloorFullscreenChange($event)">
          </app-floor-plan>

          <ion-modal
            [isOpen]="isFloorFullscreen"
            cssClass="floor-plan-fullscreen-modal"
            [backdropDismiss]="false"
            (didDismiss)="onFloorFullscreenChange(false)">
            <ng-template>
              <app-floor-plan
                [floorData]="selectedFloorData"
                [floors]="buildingData.floors"
                [activeFloorValue]="selectedFloorValue"
                [showBackButton]="true"
                [headerTitle]="selectedFloorData?.floorName"
                [fullscreenContext]="true"
                (backRequested)="resetToBuildingOverview()"
                (floorChange)="onFloorSelected($event)"
                (fullscreenChange)="onFloorFullscreenChange($event)">
              </app-floor-plan>
            </ng-template>
          </ion-modal>
        </div>
      </ng-container>
    </div>

    <app-bottom-sheet *ngIf="!isFloorFullscreen"></app-bottom-sheet>
  </div>

</ion-content>
